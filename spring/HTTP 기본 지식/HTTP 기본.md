# HTTP 기본

**HTTP**

HTTP는 HyperText Transfer Protocol의 약어로 원래는 하이퍼텍스트 문서를 주고받기 위해 나온 프로토콜이지만 지금은 HTML, TEXT 같은 문서 뿐만 아니라 이미지, 음성, 영상, 파일, JSON, XML... 등등 모든 형태의 데이터를 주고받기 위해 사용되고 있다. 우리가 사용하는 HTTP 기능들은 HTTP 1.1버전에 정리되어 있으며, HTTP 2, 3버전은 기능을 같지만 성능을 개선한 버전이다. 그래서 대부분 HTTP 1.1버전을 사용하지만, HTTP 2, 3버전도 많이 사용되는 추세다. 특히 HTTP 3버전은 HTTP 1.1, 2버전과 다르게 TCP가 아닌 UDP를 사용한다.

HTTP 특징

- 클라이언트 서버 구조
- 무상태 프로토콜(스테이스리스)
- 비연결성
- HTTP 메시지
- 단순함, 확장 가능

**클라이언트 서버 구조**

HTTP는 클라이언트 서버 구조로 클라이언트가 서버에게 요청(Request)을 하면 서버가 요청에 대한 결과를 만들어 응답(Response)한다.

**무상태 프로토콜(스테이스리스)**

상태 유지 프로토콜은 서버가 클라이언트와 통신을 하고 연결을 계속 유지하며 클라이언트의 상태를 보존하는 것이며, 무상태 프로토콜은 서버가 클라이언트와 통신을 하고 연결을 끊어 클라이언트의 상태를 보존하지 않는 것이다.

상태 유지 프로토콜

- 서버와 클라이언트가 N 대 1
- 서버가 클라이언트의 상태를 보존에 클라이언트가 전달할 데이터 양이 적다
- 서버에 장애가 생기면 클라이언트 상태가 다 날라가기 때문에 다른 서버와 처음부터 다시 통신해야한다

무상태 프로토콜

- 클라이언트가 통신을 시도할 때마다 서버와 연결. 즉, 클라이언트 별로 정해진 서버가 없다
- 클라이언트 별로 정해진 서버가 없기 때문에 같은 기능을 하는 서버를 수평 확장하는데 편하다(스케일 아웃)
- 클라이언트 상태를 보존하지 않기 때문에 클라이언트가 전달한 데이터 양이 크다
- 어떤 과정중 서버에 장애가 생겨도 다른 서버와 그 과정부터 통신하면 된다

무상태 프로토콜 한계

- 항상 무상태로만 설계할 수는 없다. 예를 들어 로그인의 경우 어떤 요청을 하든 로그인한 상태는 유지해줘야 한다
- 로그인을 무상태로 설계하면 뭘 할 때마다 아이디 비번을 입력해야 한다
- 따라서 어쩔수 없이 상태 유지로 설계하는 것을 제외하고는 최대한 무상태로 설계해야 한다

**비연결성**

HTTP는 무상태 프로토콜이기 때문에 클라이언트가 요청을 주면 서버가 응답을 해주고 TCP/IP 연결을 끊는다. 그래서 서버의 자원도 효율적으로 사용한다.

비연결성 한계

- 요청이 들어올 때마다 TCP 3way handshake 과정이 필요
- 웹 브라우저로 사이트를 요청하기 때문에 HTML 뿐 아니라 JS, CSS, 추가이미지와 같은 많은 자원이 함께 다운로드
- 그렇게 되면 연결->HTML요청/응답->종료->연결->JS요청/응답->종료->연결->CSS요청/응답->종료->... 되게 길어진다. 연결과 종료가 너무 낭비된다

비연결성 극복

- 그래서 웹 브라우저가 랜더링할 많은 데이터를 한번의 연결로 다 응답하는 HTTP 지속 연결로 극복했다.
- 연결->HTTP요청/응답->CSS요청/응답->JS요청/응답->추가이미지 요청/응답->종료. 훨씬 나아졌다
- HTTP 2, 3버전은 더 많은 최적화가 이루어졌다

**HTTP 메시지**

HTTP 메시지 구조

- 시작 라인(start-line)
- 헤더(header)
- 공백(empty line. 필수)
- 본문(message body)

시작 라인

- 요청 메시지의 시작 라인: method 공백 request-target 공백 HTTP version
  method는 서버가 수행 해야할 동작(GET-조회, POST-요청 처리..), request-target은 요청 대상(절대 경로)
- 응답 메시지의 시작 라인: HTTP version 공백 status-code 공백 reason-phrase
  status-code는 요청에 대한 상태(성공, 실패), reason-phrase는 사람이 이해할 수 있는 status-code 설명 글

헤더

- field-name: OWS field-value OWS (OWS는 공백이 있어도 되고 없어도 된다)
- field-name 만 대소문자 구분이 없다
- 헤더에는 본문에 들어갈 데이터를 제외하고 필요한 모든 부가 정보를 담는다
- 본문 타입, 본문 크기, 압축, 캐시 관리 정보, 클라이언트 정보, 서버 정보...

본문

- 실제 전송할 데이터
- 바이트로 표현할 수 있는 모든 데이터는 가능
