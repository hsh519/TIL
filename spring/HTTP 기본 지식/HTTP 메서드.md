# HTTP 메서드

HTTP API를 설계할때는 리소스 식별이 가장 중요하다. 예를 들어 회원에 관한 수많은 기능이 있어 API URI를 설계하려고 할 때 조회, 수정, 추가, 삭제와 같은 기능은 완전히 배제하고 오로지 리소스를 가지고 URI에 매핑해야 한다. 즉, 회원을 member라고 했을때 회원목록 조희는 members, 회원 조회는 members/{id} 이런 식으로 설계한다. read, create와 같이 기능을 뜻하는 단어는 URI 설계에서 사용하지 않는다. 그렇다면 회원 조회, 회원 수정, 회원 삭제 모두 어떤 회원의 데이터를 가지고 있어야 하기 때문에 members/{id} 일텐데 이 URI로 조회, 수정, 삭제중 어떤 기능인지 어떻게 구분할까? 바로 HTTP 메서드이다.

**HTTP 메서드**

- GET
- POST
- PUT
- PATCH
- DELETE
- 기타 메서드로 HEAD, OPTIONS, CONNECT, TRACE가 있다

GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 쿼리 스트링을 통해 전달 ex) 검색어
- 본문을 사용해서 데이터를 전달할 수 있지만 지원하지 않는 곳이 많아서 권장X

POST

- 본문에 작성한 요청 데이터 처리
- 따라서 클라이언트는 데이터를 넘겨주기만 하고 서버가 알아서 처리하는 구조
- 즉, 클라이언트가 리소스의 위치를 몰라도 서버가 알아서 해준다
- 어떤 처리를 한다라고 정해져 있는 것이 아니라서 리소스마다 어떻게 처리할 것인지 정해야 한다
- 보통 신규 등록, 프로세스 처리등에 사용된다
- 어떤 메서드를 써도 애매할 것 같다면 만능 메서드 POST를 사용한다

PUT

- 리소스가 있다면 리소스를 본문에 작성한 데이터로 대체, 없다면 생성
- 대체하든, 생성하든 리소스의 위치를 알고 있어야 요청을 할 수 있다
- POST와는 다르게 클라이언트가 리소스의 위치를 알고 있어야 하며, 그 위치에 PUT 요청을 해야한다
- PUT은 데이터를 완전히 대체하기 때문에 데이터 하나를 빼먹은 상태에서 PUT 요청을 한다면 그대로 대체된다

PATCH

- 리소스 부분 변경
- PUT으로 리소스를 변경하다가 위에서 말했던 것처럼 데이터를 하나 빼먹은 상태라도 그대로 변경할 수 있다
- 그런 위험부담을 없애기 위해 사용하는 것이 PATCH
- 본문에 작성한 필드만 변경. 본문에 없는 필드는 그대로

DELETE

- 리소스 제거

**HTTP 메서드 속성**

- 안전
- 멱등
- 캐시 가능

안전

- 호출해도 리소스를 변경하지 않는다
- 안전 속성을 가진 메서드는 GET

멱등

- 몇번을 호출해도 같은 결과를 불러온다
- HTTP 메서드를 원래 목적에 맞게 사용했을 때 멱등 속성을 가진 메서드는 GET, PUT, DELETE
- 앞의 조건을 붙인 이유는 만약 GET을 데이터 조회가 아닌 본문에 데이터를 넣어 처리하는 용도로 사용한다면 멱등 속성을 가질수 없다. PUT도 데이터 대체가 아닌 요청할 때마다 특정 필드 값이 증가하도록 설계한다면 멱등 속성을 가질수 없다
- 멱등 속성을 가지지 못하는 메서드는 POST, PATCH
- 만약 POST가 결제 기능을 가지고 있다면 호출 할 때마다 결제 횟수가 증가한다. 또한 PATCH도 호출할 때마다 특정 필드 값이 증가하도록 설계했다면 멱등 속성을 항상 가진다고 할 수 없다
- 멱등 속성은 자동 복구 메커니즘에서 서버가 정상적인 응답을 못했을 때 클라이언트가 재요청을 해도 되는지에 대한 근거로 활용된다. POST, PATCH는 재요청하면 큰일난다

캐시 가능

- 응답 결과 리소스를 캐시해서 사용해도 되는가
- 캐시가 가능한 메서드는 GET, HEAD, POST, PATCH. 하지만 실제로는 GET, HEAD 정도만 쓴다
- POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데 구현이 쉽지 않기 때문
